group_by(GEOID) %>%
summarise(
n_requests = n(),
mean_days = mean(days_to_complete, na.rm = TRUE),
median_days = median(days_to_complete, na.rm = TRUE)
)
# Attach results back to tract geometries
tracts_d3 <- tracts_d3 %>%
left_join(mean_response_by_tract, by = "GEOID")
ggplot(tracts_d3) +
geom_sf(aes(fill = mean_days), color = "white", size = 0.3) +
scale_fill_gradient2(
low = "green",
mid = "yellow",
high = "red",
midpoint = median(tracts_d3$mean_days, na.rm = TRUE),
name = "Mean Days to Complete"
) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Mean 311 Response Time by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
# 1. Combine mean response & number of requests
tract_summary <- tracts_d3 %>%
st_set_geometry(NULL) %>%
select(GEOID, n_requests, mean_days, median_days)
# 2. Add most common service type
tract_summary <- tract_summary %>%
left_join(
tracts_d3_service %>%
st_set_geometry(NULL) %>%
select(GEOID, service_name) %>%
rename(most_common_service = service_name),
by = "GEOID"
) %>%
arrange(GEOID)
# 3. Display with kable
kable(
tract_summary,
caption = "District 3 Census Tracts: Mean Response Time, Most Common Service, and Number of 311 Requests",
digits = 1
)
# 1. Combine mean response & number of requests
tract_summary <- tracts_d3 %>%
st_set_geometry(NULL) %>%
select(GEOID, n_requests, mean_days, median_days)
# 2. Add most common service type
tract_summary <- tracts_d3 %>%
st_set_geometry(NULL) %>%
select(GEOID, n_requests, mean_days, median_days) %>%
inner_join(
tracts_d3_service %>%
st_set_geometry(NULL) %>%
select(GEOID, service_name) %>%
rename(most_common_service = service_name),
by = "GEOID"
) %>%
arrange(GEOID)
# 3. Display with kable
kable(
tract_summary,
caption = "District 3 Census Tracts: Mean Response Time, Most Common Service, and Number of 311 Requests",
digits = 1
)
# Get all roads in Philadelphia
philly_roads <- roads(state = "PA", county = "Philadelphia", year = 2023) %>%
st_transform(pa_crs)
# Filter to major roads only
major_roads <- philly_roads %>%
filter(MTFCC %in% c("S1100", "S1200", "S1400"))  # S1100 = Primary roads, S1200 = Secondary roads, S1400 = ramps
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads, color = "gray30", size = 0.4, alpha = 0.7) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
# Filter to major roads only
major_roads <- philly_roads %>%
filter(MTFCC %in% c("S1100"))  # S1100 = Primary roads
major_roads_d3 <- st_intersection(major_roads, district3)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
# Get all roads in Philadelphia
philly_roads <- roads(state = "PA", county = "Philadelphia", year = 2023) %>%
st_transform(pa_crs)
# Filter to major roads only
major_roads <- philly_roads %>%
filter(MTFCC %in% c("S1100", "S1200"))  # S1100 = Primary roads
major_roads_d3 <- st_intersection(major_roads, district3)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
View(major_roads_d3)
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = mean_days), color = "white", size = 0.3) +
scale_fill_gradient2(
low = "green",
mid = "yellow",
high = "red",
midpoint = median(tracts_d3$mean_days, na.rm = TRUE),
name = "Mean Days to Complete"
) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Mean 311 Response Time by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(
data = major_roads_d3,
aes(color = "Major Road"),  # map a constant for legend
size = 0.4,
alpha = 0.7
) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(
data = major_roads_d3,
aes(color = "Major Road"),  # map a constant for legend
size = 0.4,
alpha = 0.5
) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.6) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.3) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
# Filter to District 3
district3 <- philly_council_districts %>%
filter(DISTRICT == 3)
major_roads_d3 <- st_intersection(major_roads, district3)
# Spatial join: keep only 311 points inside District 3
df_2023_d3 <- st_join(df_2023_sf, district3, join = st_within, left = FALSE)
df_2024_d3 <- st_join(df_2024_sf, district3, join = st_within, left = FALSE)
# Filter tracts that intersect District 3
tracts_d3 <- st_intersection(philly_tracts, district3)
# Combine years and compute completion time
df_d3_combined <- bind_rows(df_2023_d3, df_2024_d3) %>%
mutate(
requested_datetime = as.POSIXct(requested_datetime),
closed_datetime = as.POSIXct(closed_datetime),
days_to_complete = as.numeric(difftime(closed_datetime, requested_datetime, units = "days"))
) %>%
filter(!is.na(days_to_complete))
# Join each 311 record to its census tract
df_d3_combined_tracts <- st_join(df_d3_combined, tracts_d3, join = st_within)
# Mean and median response time by tract
mean_response_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID) %>%
summarise(
n_requests = n(),
mean_days = mean(days_to_complete, na.rm = TRUE),
median_days = median(days_to_complete, na.rm = TRUE)
)
# Attach results back to tract geometries
tracts_d3 <- tracts_d3 %>%
left_join(mean_response_by_tract, by = "GEOID")
ggplot(tracts_d3) +
geom_sf(aes(fill = mean_days), color = "white", size = 0.3) +
scale_fill_gradient2(
low = "green",
mid = "yellow",
high = "red",
midpoint = median(tracts_d3$mean_days, na.rm = TRUE),
name = "Mean Days to Complete"
) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Mean 311 Response Time by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = mean_days), color = "white", size = 0.3) +
scale_fill_gradient2(
low = "green",
mid = "yellow",
high = "red",
midpoint = median(tracts_d3$mean_days, na.rm = TRUE),
name = "Mean Days to Complete"
) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Mean 311 Response Time by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
most_common_service_by_tract <- df_d3_combined_tracts %>%
st_set_geometry(NULL) %>%
group_by(GEOID, service_name) %>%
summarise(n = n()) %>%
slice_max(order_by = n, n = 1, with_ties = FALSE) %>%
ungroup()
tracts_d3_service <- tracts_d3 %>%
left_join(most_common_service_by_tract, by = "GEOID")
ggplot(tracts_d3_service) +
geom_sf(aes(fill = service_name), color = "white", size = 0.3) +
geom_sf(data = district3, fill = NA, color = "black", size = 0.6) +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Most Common 311 Service Type by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
fill = "Service Type",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
ggplot(tracts_d3) +
geom_sf(aes(fill = n_requests), color = "white", size = 0.3) +
scale_fill_viridis_c(option = "plasma", trans = "sqrt", name = "Number of Requests") +
geom_sf(data = major_roads_d3, fill = NA, color = "black", size = 0.2) +
labs(
title = "Number of 311 Requests by Census Tract in District 3",
subtitle = "Combined 2023 and 2024",
caption = "Data: Philadelphia 311"
) +
theme_minimal() +
theme(
axis.text = element_blank(),
axis.ticks = element_blank(),
panel.grid = element_blank()
)
quarto add quarto-ext/lightbox
add quarto-ext/lightbox
reticulate::repl_python()
